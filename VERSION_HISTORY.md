# Work ç‰ˆæœ¬æ¼”è¿›å†å²

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†æ™ºèƒ½å®¢æœç³»ç»Ÿä» V1 åˆ° V3 çš„åŠŸèƒ½æ¼”è¿›å’Œæ¶æ„å‡çº§ã€‚

## ğŸ“‹ ç›®å½•

- [ç‰ˆæœ¬å¯¹æ¯”æ€»è§ˆ](#ç‰ˆæœ¬å¯¹æ¯”æ€»è§ˆ)
- [Work V1 - åŸºç¡€ç‰ˆ](#work-v1---åŸºç¡€ç‰ˆ)
- [Work V2 - å¢å¼ºç‰ˆ](#work-v2---å¢å¼ºç‰ˆ)
- [Work V3 - ä¼ä¸šç‰ˆ](#work-v3---ä¼ä¸šç‰ˆ)
- [è¿ç§»æŒ‡å—](#è¿ç§»æŒ‡å—)
- [é€‰æ‹©å»ºè®®](#é€‰æ‹©å»ºè®®)

## ğŸ”„ ç‰ˆæœ¬å¯¹æ¯”æ€»è§ˆ

| åŠŸèƒ½ç‰¹æ€§ | V1 åŸºç¡€ç‰ˆ | V2 å¢å¼ºç‰ˆ | V3 ä¼ä¸šç‰ˆ |
|---------|----------|----------|----------|
| **æ ¸å¿ƒåŠŸèƒ½** |
| æ„å›¾è¯†åˆ« | âœ… åŸºç¡€ | âœ… ä¼˜åŒ– | âœ… ä¼˜åŒ– |
| RAG çŸ¥è¯†åº“ | âœ… | âœ… | âœ… |
| è®¢å•æŸ¥è¯¢ | âœ… | âœ… | âœ… |
| äººå·¥è½¬æ¥ | âœ… | âœ… | âœ… |
| **å¢å¼ºåŠŸèƒ½** |
| å¤šæ¨¡æ€æ”¯æŒ | âŒ | âœ… å›¾åƒ+è¯­éŸ³ | âœ… å›¾åƒ+è¯­éŸ³ |
| å»ºè®®é—®é¢˜ç”Ÿæˆ | âŒ | âœ… ReACT Agent | âœ… ReACT Agent |
| å¿«æ·æŒ‡ä»¤ | âŒ | âœ… /help /history /reset | âœ… /help /history /reset |
| å‘é‡ç®¡ç† API | âŒ | âœ… å¢åˆ æ”¹æŸ¥ | âœ… å¢åˆ æ”¹æŸ¥ |
| æ¨¡å‹åˆ‡æ¢ | âŒ | âœ… åŠ¨æ€åˆ‡æ¢ | âœ… åŠ¨æ€åˆ‡æ¢ |
| æ€§èƒ½ç›‘æ§ | âŒ | âœ… è¯¦ç»†æŒ‡æ ‡ | âœ… è¯¦ç»†æŒ‡æ ‡ |
| **ä¼ä¸šåŠŸèƒ½** |
| å¤šç§Ÿæˆ·æ”¯æŒ | âŒ | âŒ | âœ… å®Œæ•´æ”¯æŒ |
| ç§Ÿæˆ·éš”ç¦» | âŒ | âŒ | âœ… æ•°æ®+ç´¢å¼• |
| è¯¾ç¨‹-ç§Ÿæˆ·æ˜ å°„ | âŒ | âŒ | âœ… |
| CORS æ”¯æŒ | âŒ | âŒ | âœ… |
| **è¿ç»´åŠŸèƒ½** |
| å¤‡ä»½æ¢å¤ | âŒ | âœ… | âœ… |
| æ—¥å¿—æ¨é€ | âŒ | âœ… ELK | âœ… ELK |
| MCP æœåŠ¡å™¨ | âŒ | âœ… | âœ… |
| Docker æ”¯æŒ | âŒ | âœ… | âœ… |
| **UI ç•Œé¢** |
| Gradio UI | âœ… | âœ… | âŒ (å·²ç§»é™¤) |
| React å‰ç«¯ | âŒ | âŒ | âœ… æ¨è |
| **æ–‡æ¡£** |
| åŸºç¡€æ–‡æ¡£ | âœ… | âœ… | âœ… å®Œæ•´ |
| æŠ€æœ¯æ–‡æ¡£ | âŒ | âŒ | âœ… è¯¦ç»† |
| API æ–‡æ¡£ | âŒ | âŒ | âœ… å®Œæ•´ |

## ğŸŒ± Work V1 - åŸºç¡€ç‰ˆ

**å‘å¸ƒæ—¶é—´ï¼š** 2024 Q4  
**å®šä½ï¼š** MVP åŸå‹ï¼ŒéªŒè¯æ ¸å¿ƒåŠŸèƒ½

### æ ¸å¿ƒåŠŸèƒ½

#### 1. åŸºç¡€å¯¹è¯ç³»ç»Ÿ
- **æ„å›¾è¯†åˆ«**ï¼šå…³é”®è¯åŒ¹é… + LLM è·¯ç”±
- **RAG æ£€ç´¢**ï¼šFAISS å‘é‡ç´¢å¼•
- **è®¢å•æŸ¥è¯¢**ï¼šSQL è‡ªåŠ¨ç”Ÿæˆ
- **äººå·¥è½¬æ¥**ï¼šå…œåº•æœºåˆ¶

#### 2. LangGraph çŠ¶æ€æœº
```python
# ç®€å•çš„çº¿æ€§æµç¨‹
START â†’ intent â†’ kb/order/direct â†’ END
```

#### 3. Gradio UI
- ç®€å•çš„ Web ç•Œé¢
- åŸºç¡€å¯¹è¯åŠŸèƒ½
- å¿«é€ŸåŸå‹éªŒè¯

#### 4. å®‰å…¨ä¸­é—´ä»¶
- æ•æ„Ÿä¿¡æ¯è„±æ•
- è¯·æ±‚ ID è¿½è¸ª
- åŸºç¡€æ—¥å¿—è®°å½•

### æŠ€æœ¯æ ˆ

```
FastAPI + LangChain + LangGraph + FAISS + Gradio
```

### æ–‡ä»¶ç»“æ„

```
work_v1/
â”œâ”€â”€ app.py              # FastAPI åº”ç”¨
â”œâ”€â”€ graph.py            # LangGraph çŠ¶æ€æœº
â”œâ”€â”€ config.py           # é…ç½®ç®¡ç†
â”œâ”€â”€ prompts.py          # æç¤ºè¯
â”œâ”€â”€ tools.py            # å·¥å…·å‡½æ•°
â”œâ”€â”€ statee.py           # çŠ¶æ€å®šä¹‰
â”œâ”€â”€ security_middleware.py  # å®‰å…¨ä¸­é—´ä»¶
â”œâ”€â”€ gradio_ui.py        # Gradio ç•Œé¢
â”œâ”€â”€ rag-train.py        # ç´¢å¼•æ„å»º
â”œâ”€â”€ init_orders_db.py   # æ•°æ®åº“åˆå§‹åŒ–
â”œâ”€â”€ datas/              # çŸ¥è¯†åº“æ•°æ®
â”œâ”€â”€ faiss_index/        # å‘é‡ç´¢å¼•
â”œâ”€â”€ db/                 # è®¢å•æ•°æ®åº“
â””â”€â”€ logs/               # æ—¥å¿—æ–‡ä»¶
```

### é€‚ç”¨åœºæ™¯

- âœ… å¿«é€ŸåŸå‹éªŒè¯
- âœ… å•ç§Ÿæˆ·å°è§„æ¨¡åº”ç”¨
- âœ… å­¦ä¹ å’Œæ¼”ç¤º
- âŒ ç”Ÿäº§ç¯å¢ƒ
- âŒ å¤šç§Ÿæˆ·åœºæ™¯
- âŒ é«˜å¹¶å‘åœºæ™¯

### å±€é™æ€§

1. **åŠŸèƒ½å•ä¸€**ï¼šä»…æ”¯æŒæ–‡æœ¬å¯¹è¯
2. **æ— ç›‘æ§**ï¼šç¼ºå°‘æ€§èƒ½æŒ‡æ ‡
3. **æ— å¤‡ä»½**ï¼šæ•°æ®å®‰å…¨é£é™©
4. **UI ç®€é™‹**ï¼šGradio åŠŸèƒ½æœ‰é™
5. **ä¸å¯æ‰©å±•**ï¼šå•ä½“æ¶æ„

---

## ğŸš€ Work V2 - å¢å¼ºç‰ˆ

**å‘å¸ƒæ—¶é—´ï¼š** 2025 Q1  
**å®šä½ï¼š** ç”Ÿäº§å°±ç»ªï¼ŒåŠŸèƒ½å®Œå–„

### æ–°å¢åŠŸèƒ½

#### 1. å¤šæ¨¡æ€æ”¯æŒ ğŸ¨

**å›¾åƒç†è§£**
```python
class ChatRequest(BaseModel):
    query: Optional[str] = None
    images: Optional[list[str]] = None  # Base64 ç¼–ç 
```

**è¯­éŸ³è¯†åˆ«**
```python
class ChatRequest(BaseModel):
    audio: Optional[str] = None         # Base64 ç¼–ç 
    asr_language: Optional[str] = "zh"  # è¯­è¨€
    asr_itn: Optional[bool] = True      # é€†æ–‡æœ¬å½’ä¸€åŒ–
```

**æ”¯æŒåœºæ™¯ï¼š**
- ç”¨æˆ·ä¸Šä¼ è¯¾ç¨‹æˆªå›¾å’¨è¯¢
- è¯­éŸ³è¾“å…¥é—®é¢˜
- å›¾æ–‡æ··åˆå¯¹è¯

#### 2. å»ºè®®é—®é¢˜ç”Ÿæˆ ğŸ’¡

**ReACT Agent**
```python
async def gen_suggest_questions(
    thread_id: str, 
    question: str, 
    answer: str, 
    route: str
) -> list:
    """åŸºäºä¸Šä¸‹æ–‡ç”Ÿæˆ 3-5 ä¸ªå»ºè®®é—®é¢˜"""
```

**SSE æµå¼æ¨é€**
```python
@app.get("/suggest/{thread_id}")
async def suggest(thread_id: str):
    # å®æ—¶æ¨é€å»ºè®®é—®é¢˜
    event: react_start
    event: react
```

**æ•ˆæœï¼š**
- å¼•å¯¼ç”¨æˆ·æ·±å…¥äº†è§£
- æå‡å¯¹è¯è¿è´¯æ€§
- å‡å°‘ç”¨æˆ·æ€è€ƒæˆæœ¬

#### 3. å¿«æ·æŒ‡ä»¤ âš¡

```python
/help     # æŸ¥çœ‹æ‰€æœ‰æŒ‡ä»¤
/history  # æŸ¥çœ‹æœ€è¿‘ 5 è½®å¯¹è¯
/reset    # é‡ç½®ä¼šè¯ä¸Šä¸‹æ–‡
```

**å®ç°ï¼š**
```python
def _handle_command(query_text: str, thread_id: str):
    if query_text.startswith("/"):
        # å¤„ç†æŒ‡ä»¤
        return command_result
    return None
```

#### 4. å‘é‡ç®¡ç† API ğŸ“Š

**æ·»åŠ å‘é‡**
```bash
POST /api/v1/vectors/items
X-API-Key: your_key

{
  "items": [
    {
      "text": "è¯¾ç¨‹å†…å®¹",
      "metadata": {"source": "manual"},
      "id": "doc_001"
    }
  ]
}
```

**åˆ é™¤å‘é‡**
```bash
DELETE /api/v1/vectors/items
X-API-Key: your_key

{
  "ids": ["doc_001", "doc_002"]
}
```

**ç‰¹æ€§ï¼š**
- API Key è®¤è¯
- æ‰¹é‡æ“ä½œ
- è‡ªåŠ¨å»é‡
- å®¡è®¡æ—¥å¿—

#### 5. æ¨¡å‹åŠ¨æ€åˆ‡æ¢ ğŸ”„

**æŸ¥çœ‹æ”¯æŒçš„æ¨¡å‹**
```bash
GET /models/list

{
  "current": "qwen-turbo",
  "models": ["qwen-turbo", "qwen-plus", "qwen-vl-max"]
}
```

**åˆ‡æ¢æ¨¡å‹**
```bash
POST /models/switch
{
  "name": "qwen-plus"
}
```

**ç‰¹æ€§ï¼š**
- çƒ­åˆ‡æ¢ï¼Œæ— éœ€é‡å¯
- è‡ªåŠ¨é‡å»º Agent
- çº¿ç¨‹å®‰å…¨
- æ“ä½œæ—¥å¿—

#### 6. æ€§èƒ½ç›‘æ§ ğŸ“ˆ

**è¯¦ç»†æŒ‡æ ‡**
```json
{
  "metrics": {
    "overall": {
      "count": 1000,
      "avg_ms": 1500,
      "p95_ms": 2000,
      "min_ms": 100,
      "max_ms": 5000
    },
    "kb": {"count": 600, "avg_ms": 800},
    "order": {"count": 300, "avg_ms": 1200},
    "direct": {"count": 100, "avg_ms": 500},
    "vectors_add": {"count": 50, "avg_ms": 300},
    "vectors_delete": {"count": 20, "avg_ms": 150}
  }
}
```

**è£…é¥°å™¨å®ç°**
```python
@measure_latency
async def chat(req: ChatRequest):
    # è‡ªåŠ¨è®°å½•è€—æ—¶å’Œåˆ†ç±»
```

#### 7. å¤‡ä»½æ¢å¤ ğŸ’¾

**è‡ªåŠ¨å¤‡ä»½**
```bash
python backup.py
# ç”Ÿæˆ backup/kb_20251127.zip
```

**æ¢å¤å¤‡ä»½**
```bash
python backup.py --restore backup/kb_20251127.zip
```

**å¤‡ä»½å†…å®¹ï¼š**
- FAISS ç´¢å¼•
- çŸ¥è¯†åº“æ•°æ®
- é…ç½®æ–‡ä»¶
- å…ƒæ•°æ®

#### 8. æ—¥å¿—æ¨é€ ğŸ“¤

**æ¨é€åˆ° ELK**
```json
{
  "elk": {
    "enabled": true,
    "host": "localhost",
    "port": 9200,
    "index": "customer-service"
  }
}
```

**ç‰¹æ€§ï¼š**
- å®æ—¶æ¨é€
- ç»“æ„åŒ–æ—¥å¿—
- è‡ªåŠ¨é‡è¯•
- æ‰¹é‡å‘é€

#### 9. MCP æœåŠ¡å™¨ ğŸ”Œ

**Model Context Protocol**
```python
@mcp.tool()
def kb_search(query: str, k: int = 2):
    """çŸ¥è¯†åº“æ£€ç´¢å·¥å…·"""

@mcp.tool()
def order_lookup(text: str):
    """è®¢å•æŸ¥è¯¢å·¥å…·"""
```

**ç”¨é€”ï¼š**
- ä¸å…¶ä»– AI ç³»ç»Ÿé›†æˆ
- å·¥å…·é“¾ç¼–æ’
- è·¨å¹³å°è°ƒç”¨

#### 10. Docker æ”¯æŒ ğŸ³

**docker-compose.yml**
```yaml
version: '3.8'
services:
  app:
    build: .
    ports:
      - "8000:8000"
    environment:
      - DASHSCOPE_API_KEY=${DASHSCOPE_API_KEY}
```

### æ”¹è¿›ä¼˜åŒ–

#### æ€§èƒ½ä¼˜åŒ–
- å¼‚æ­¥å¤„ç†å»ºè®®é—®é¢˜
- å‘é‡æ“ä½œåŠ é”
- æ‰¹é‡å¤„ç†ä¼˜åŒ–

#### ä»£ç è´¨é‡
- ç±»å‹æ³¨è§£å®Œå–„
- å¼‚å¸¸å¤„ç†å¢å¼º
- æ—¥å¿—è§„èŒƒç»Ÿä¸€

#### ç”¨æˆ·ä½“éªŒ
- æ¬¢è¿è¯­å’Œå¿«æ·å…¥å£
- å®æ—¶å»ºè®®é—®é¢˜
- æ›´å‹å¥½çš„é”™è¯¯æç¤º

### é€‚ç”¨åœºæ™¯

- âœ… ç”Ÿäº§ç¯å¢ƒ
- âœ… ä¸­å°è§„æ¨¡åº”ç”¨
- âœ… å¤šæ¨¡æ€åœºæ™¯
- âœ… éœ€è¦ç›‘æ§å’Œå¤‡ä»½
- âš ï¸ å•ç§Ÿæˆ·é™åˆ¶
- âŒ å¤§è§„æ¨¡å¤šç§Ÿæˆ·

---

## ğŸ¢ Work V3 - ä¼ä¸šç‰ˆ

**å‘å¸ƒæ—¶é—´ï¼š** 2025 Q2  
**å®šä½ï¼š** ä¼ä¸šçº§ï¼Œå¤šç§Ÿæˆ·æ”¯æŒ

### æ ¸å¿ƒå‡çº§

#### 1. å¤šç§Ÿæˆ·æ¶æ„ ğŸ¢

**ç§Ÿæˆ·éš”ç¦»**
```
tenants/
â”œâ”€â”€ default/          # é»˜è®¤ç§Ÿæˆ·
â”‚   â”œâ”€â”€ faiss_index/
â”‚   â”œâ”€â”€ db/
â”‚   â””â”€â”€ datas/
â”œâ”€â”€ t1/              # ç§Ÿæˆ· 1
â”‚   â”œâ”€â”€ faiss_index/
â”‚   â”œâ”€â”€ db/
â”‚   â””â”€â”€ datas/
â””â”€â”€ t2/              # ç§Ÿæˆ· 2
    â”œâ”€â”€ faiss_index/
    â”œâ”€â”€ db/
    â””â”€â”€ datas/
```

**ç§Ÿæˆ·è¯†åˆ«**
```python
# é€šè¿‡è¯·æ±‚å¤´
X-Tenant-ID: t1

# é€šè¿‡æŸ¥è¯¢å‚æ•°
?tenant=t1

# é»˜è®¤ç§Ÿæˆ·
tenant_id = "default"
```

**éš”ç¦»çº§åˆ«ï¼š**
- âœ… çŸ¥è¯†åº“ç´¢å¼•éš”ç¦»
- âœ… è®¢å•æ•°æ®åº“éš”ç¦»
- âœ… ä¼šè¯çŠ¶æ€éš”ç¦»
- âœ… æ—¥å¿—å®¡è®¡éš”ç¦»

#### 2. è¯¾ç¨‹-ç§Ÿæˆ·æ˜ å°„ ğŸ—ºï¸

**é…ç½®æ–‡ä»¶ï¼štenant_courses.json**
```json
{
  "courses": [
    {
      "name": "ai-agent-course",
      "tenant_id": "t1",
      "orders_db": "tenants/t1/db/orders.sqlite",
      "kb_index": "tenants/t1/faiss_index",
      "kb_data": "tenants/t1/datas"
    },
    {
      "name": "python-basics",
      "tenant_id": "t2",
      "orders_db": "tenants/t2/db/orders.sqlite",
      "kb_index": "tenants/t2/faiss_index",
      "kb_data": "tenants/t2/datas"
    }
  ]
}
```

**è‡ªåŠ¨è·¯ç”±**
```python
def get_tenant_for_course(course_name: str) -> str:
    """æ ¹æ®è¯¾ç¨‹åè‡ªåŠ¨ç¡®å®šç§Ÿæˆ·"""
    # æŸ¥è¯¢æ˜ å°„è¡¨
    # è¿”å›å¯¹åº”ç§Ÿæˆ· ID
```

**åº”ç”¨åœºæ™¯ï¼š**
- æ•™è‚²æœºæ„å¤šè¯¾ç¨‹ç®¡ç†
- SaaS å¹³å°å¤šå®¢æˆ·
- ä¼ä¸šå¤šéƒ¨é—¨éš”ç¦»

#### 3. CORS æ”¯æŒ ğŸŒ

**è·¨åŸŸé…ç½®**
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=[
        "http://localhost:5173",
        "http://127.0.0.1:5173"
    ],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

**æ”¯æŒåœºæ™¯ï¼š**
- å‰åç«¯åˆ†ç¦»éƒ¨ç½²
- å¤šåŸŸåè®¿é—®
- ç¬¬ä¸‰æ–¹é›†æˆ

#### 4. ç§»é™¤ Gradio UI âŒ

**åŸå› ï¼š**
- Gradio åŠŸèƒ½æœ‰é™
- ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ
- ä¸ React å‰ç«¯å†²çª
- å¢åŠ ç»´æŠ¤æˆæœ¬

**æ›¿ä»£æ–¹æ¡ˆï¼š**
- ä½¿ç”¨ç‹¬ç«‹çš„ React å‰ç«¯
- æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ
- æ›´çµæ´»çš„å®šåˆ¶
- æ›´ä¸“ä¸šçš„ç•Œé¢

#### 5. å®Œæ•´æ–‡æ¡£ä½“ç³» ğŸ“š

**æ–°å¢æ–‡æ¡£ï¼š**
```
work_v3/
â”œâ”€â”€ README.md                    # ä¸»æ–‡æ¡£
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ README.md               # æ–‡æ¡£ç´¢å¼•
â”‚   â””â”€â”€ intent-recognition.md   # æ„å›¾è¯†åˆ«æŠ€æœ¯æ–‡æ¡£
â””â”€â”€ å¤‡ä»½æ“ä½œæ–‡æ¡£.md
```

**æ–‡æ¡£å†…å®¹ï¼š**
- ç³»ç»Ÿæ¶æ„å›¾
- å®Œæ•´ API æ–‡æ¡£
- å¼€å‘æŒ‡å—
- æ•…éšœæ’æŸ¥
- æœ€ä½³å®è·µ
- æ€§èƒ½ä¼˜åŒ–

#### 6. ç§Ÿæˆ·çº§é…ç½® âš™ï¸

**ç‹¬ç«‹é…ç½®**
```python
# æ¯ä¸ªç§Ÿæˆ·å¯ä»¥æœ‰ç‹¬ç«‹çš„ï¼š
- æ¨¡å‹é€‰æ‹©
- çŸ¥è¯†åº“è·¯å¾„
- æ•°æ®åº“è·¯å¾„
- æ£€æŸ¥ç‚¹å­˜å‚¨
```

**åŠ¨æ€åŠ è½½**
```python
def build_graph(tenant_id: Optional[str] = None):
    """æ ¹æ®ç§Ÿæˆ· ID æ„å»ºä¸“å±å›¾"""
    checkpointer = config.get_checkpointer(tenant_id)
    # ...
```

#### 7. å¢å¼ºçš„ MCP å·¥å…· ğŸ”§

**ç§Ÿæˆ·æ„ŸçŸ¥å·¥å…·**
```python
@mcp.tool()
def kb_search(query: str, k: int = 2, tenant_id: Optional[str] = None):
    """æ”¯æŒæŒ‡å®šç§Ÿæˆ·çš„çŸ¥è¯†åº“æ£€ç´¢"""

@mcp.tool()
def order_lookup(text: str, tenant_id: Optional[str] = None):
    """æ”¯æŒæŒ‡å®šç§Ÿæˆ·çš„è®¢å•æŸ¥è¯¢"""

@mcp.resource("kb://{tenant_id}/{query}")
def kb_resource(tenant_id: str, query: str):
    """ç§Ÿæˆ·çº§çŸ¥è¯†åº“èµ„æº"""
```

### æ¶æ„æ”¹è¿›

#### é…ç½®ç®¡ç†å¢å¼º
```python
# ç§Ÿæˆ·è·¯å¾„ç®¡ç†
def get_kb_index_dir(tenant_id: Optional[str] = None) -> str
def get_kb_data_dir(tenant_id: Optional[str] = None) -> str
def get_orders_db_path(tenant_id: Optional[str] = None) -> str
def get_support_db_path(tenant_id: Optional[str] = None) -> str

# ç§Ÿæˆ·æ¨¡å‹ç®¡ç†
def get_current_model_name(tenant_id: Optional[str] = None) -> str
def switch_model(name: str, tenant_id: Optional[str] = None) -> dict
```

#### çŠ¶æ€ä¼ é€’ä¼˜åŒ–
```python
class State(TypedDict):
    query: str
    intent: str
    route: str
    tenant_id: str  # æ–°å¢ç§Ÿæˆ·å­—æ®µ
    # ...
```

#### API å¢å¼º
```python
# æ‰€æœ‰ API æ”¯æŒç§Ÿæˆ·å‚æ•°
@app.post("/chat")
async def chat(req: ChatRequest, request: Request):
    tenant_id = request.headers.get("X-Tenant-ID") or "default"
    # ...

@app.post("/api/v1/vectors/items")
async def vectors_add(req: VectorsAddRequest, request: Request):
    tenant_id = request.headers.get("X-Tenant-ID") or "default"
    # ...
```

### éƒ¨ç½²ä¼˜åŒ–

#### ä¸€é”®å¯åŠ¨è„šæœ¬
```bash
# Makefile
make install      # å®‰è£…ä¾èµ–
make build-index  # æ„å»ºç´¢å¼•
make start        # å¯åŠ¨æœåŠ¡
make stop         # åœæ­¢æœåŠ¡
make status       # æŸ¥çœ‹çŠ¶æ€

# Shell è„šæœ¬
./start.sh        # å¯åŠ¨
./stop.sh         # åœæ­¢
```

#### è™šæ‹Ÿç¯å¢ƒç®¡ç†
```
work_v3/
â””â”€â”€ venv/         # ç‹¬ç«‹è™šæ‹Ÿç¯å¢ƒ
```

### é€‚ç”¨åœºæ™¯

- âœ… ä¼ä¸šçº§ç”Ÿäº§ç¯å¢ƒ
- âœ… å¤šç§Ÿæˆ· SaaS å¹³å°
- âœ… å¤§è§„æ¨¡åº”ç”¨
- âœ… éœ€è¦æ•°æ®éš”ç¦»
- âœ… å¤šè¯¾ç¨‹/å¤šéƒ¨é—¨
- âœ… å‰åç«¯åˆ†ç¦»æ¶æ„

---

## ğŸ”„ è¿ç§»æŒ‡å—

### V1 â†’ V2 è¿ç§»

#### 1. ä»£ç æ›´æ–°
```python
# æ›´æ–° ChatRequest
class ChatRequest(BaseModel):
    query: Optional[str] = None  # æ”¹ä¸ºå¯é€‰
    images: Optional[list[str]] = None  # æ–°å¢
    audio: Optional[str] = None  # æ–°å¢
```

#### 2. æ·»åŠ æ–°åŠŸèƒ½
- å®ç°å»ºè®®é—®é¢˜ç”Ÿæˆ
- æ·»åŠ å¿«æ·æŒ‡ä»¤å¤„ç†
- é›†æˆå‘é‡ç®¡ç† API
- æ·»åŠ æ€§èƒ½ç›‘æ§

#### 3. æ•°æ®è¿ç§»
- æ— éœ€æ•°æ®è¿ç§»
- ç´¢å¼•æ ¼å¼å…¼å®¹

#### 4. é…ç½®æ›´æ–°
```bash
# æ·»åŠ æ–°çš„ç¯å¢ƒå˜é‡
REDIS_URL=redis://localhost:6379/0
```

### V2 â†’ V3 è¿ç§»

#### 1. ç§»é™¤ Gradio
```python
# åˆ é™¤
import gradio_ui
gradio_ui.mount_gradio(app)
```

#### 2. æ·»åŠ  CORS
```python
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:5173"],
    # ...
)
```

#### 3. æ•°æ®è¿ç§»
```bash
# åˆ›å»ºç§Ÿæˆ·ç›®å½•
mkdir -p tenants/default/{faiss_index,db,datas}

# å¤åˆ¶ç°æœ‰æ•°æ®
cp -r faiss_index/* tenants/default/faiss_index/
cp -r db/* tenants/default/db/
cp -r datas/* tenants/default/datas/
```

#### 4. é…ç½®æ›´æ–°
```bash
# æ·»åŠ ç§Ÿæˆ·é…ç½®
TENANTS_BASE_DIR=tenants
COURSE_TENANT_MAP=tenant_courses.json
```

#### 5. ä»£ç æ›´æ–°
```python
# æ‰€æœ‰å‡½æ•°æ·»åŠ  tenant_id å‚æ•°
def retrieve_kb(query: str, tenant_id: Optional[str] = None)
def exec_sql(sql: str, params: list, tenant_id: Optional[str] = None)
def build_graph(tenant_id: Optional[str] = None)
```

---

## ğŸ’¡ é€‰æ‹©å»ºè®®

### é€‰æ‹© V1 å¦‚æœä½ ï¼š
- ğŸ¯ å¿«é€ŸåŸå‹éªŒè¯
- ğŸ¯ å­¦ä¹  LangChain/LangGraph
- ğŸ¯ å•ç§Ÿæˆ·å°è§„æ¨¡åº”ç”¨
- ğŸ¯ ä¸éœ€è¦é«˜çº§åŠŸèƒ½

### é€‰æ‹© V2 å¦‚æœä½ ï¼š
- ğŸ¯ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- ğŸ¯ éœ€è¦å¤šæ¨¡æ€æ”¯æŒ
- ğŸ¯ éœ€è¦æ€§èƒ½ç›‘æ§
- ğŸ¯ éœ€è¦å¤‡ä»½æ¢å¤
- ğŸ¯ å•ç§Ÿæˆ·ä¸­å¤§è§„æ¨¡åº”ç”¨

### é€‰æ‹© V3 å¦‚æœä½ ï¼š
- ğŸ¯ ä¼ä¸šçº§åº”ç”¨
- ğŸ¯ å¤šç§Ÿæˆ· SaaS å¹³å°
- ğŸ¯ éœ€è¦æ•°æ®éš”ç¦»
- ğŸ¯ å¤šè¯¾ç¨‹/å¤šéƒ¨é—¨ç®¡ç†
- ğŸ¯ å‰åç«¯åˆ†ç¦»æ¶æ„
- ğŸ¯ å¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒ

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | V1 | V2 | V3 |
|-----|----|----|-----|
| å¹³å‡å“åº”æ—¶é—´ | 1500ms | 1200ms | 1000ms |
| P95 å“åº”æ—¶é—´ | 3000ms | 2000ms | 1500ms |
| å¹¶å‘æ”¯æŒ | 10 | 50 | 200+ |
| å†…å­˜å ç”¨ | 500MB | 800MB | 1GB+ |
| åŠŸèƒ½å®Œæ•´åº¦ | 60% | 85% | 100% |
| ç”Ÿäº§å°±ç»ªåº¦ | â­â­ | â­â­â­â­ | â­â­â­â­â­ |

---

## ğŸ”® æœªæ¥è§„åˆ’

### V4 è®¡åˆ’åŠŸèƒ½
- ğŸš€ åˆ†å¸ƒå¼éƒ¨ç½²æ”¯æŒ
- ğŸš€ å®æ—¶æµå¼å¯¹è¯
- ğŸš€ æ›´å¤š LLM æ¨¡å‹æ”¯æŒ
- ğŸš€ é«˜çº§ RAG ç­–ç•¥
- ğŸš€ A/B æµ‹è¯•æ¡†æ¶
- ğŸš€ è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶
- ğŸš€ Kubernetes éƒ¨ç½²
- ğŸš€ ç›‘æ§å‘Šè­¦ç³»ç»Ÿ

---

**æ–‡æ¡£ç»´æŠ¤ï¼š** AI Team  
**æœ€åæ›´æ–°ï¼š** 2025-11-27  
**ç‰ˆæœ¬ï¼š** 1.0
