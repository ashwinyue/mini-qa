# 查询示例文档

## 完善后的参考来源格式

导入知识后，系统会返回更详细的参考来源信息，包括：

### 返回格式说明

```json
{
    "route": "course",           // 路由类型
    "answer": "AI生成的回答内容",  // 基于知识库的回答
    "sources": [                 // 参考来源列表
        {
            "index": 1,          // 来源序号
            "content": "检索到的文本内容片段（前200字）...",
            "metadata": {        // 元数据信息
                "source": "文件路径或来源标识",
                "course": "课程名称",
                "level": "难度等级",
                "duration": "课程时长",
                "id": "文档唯一标识"
            },
            "source": "简化的来源标识"
        }
    ]
}
```

## 查询示例

### 1. 基础课程查询

**请求：**
```bash
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{
    "query": "Python基础课程适合零基础吗？",
    "user_id": "user001"
  }'
```

**响应示例：**
```json
{
    "route": "course",
    "answer": "Python基础课程适合零基础学员，课程时长为40小时，包含基础语法、数据类型、函数、面向对象等内容。",
    "sources": [
        {
            "index": 1,
            "content": "Python基础课程适合零基础学员，课程时长为40小时，包含基础语法、数据类型、函数、面向对象等内容。",
            "metadata": {
                "course": "Python基础",
                "level": "初级",
                "duration": "40小时",
                "id": "py_basic_001"
            },
            "source": "课程知识库"
        }
    ]
}
```

### 2. 课程难度查询

**请求：**
```bash
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{
    "query": "JavaScript进阶课程需要什么基础？",
    "user_id": "user002"
  }'
```

**响应示例：**
```json
{
    "route": "course",
    "answer": "JavaScript进阶课程需要有JS基础，主要讲解ES6+新特性、异步编程、模块化开发等高级主题。",
    "sources": [
        {
            "index": 1,
            "content": "JavaScript进阶课程需要有JS基础，主要讲解ES6+新特性、异步编程、模块化开发等高级主题。",
            "metadata": {
                "course": "JavaScript进阶",
                "level": "中级",
                "duration": "30小时",
                "id": "js_advanced_001"
            },
            "source": "课程知识库"
        }
    ]
}
```

### 3. 课程内容查询

**请求：**
```bash
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{
    "query": "数据结构课程都讲什么？",
    "user_id": "user003"
  }'
```

**响应示例：**
```json
{
    "route": "course",
    "answer": "数据结构与算法课程涵盖常见数据结构如数组、链表、树、图，以及排序、搜索等经典算法。",
    "sources": [
        {
            "index": 1,
            "content": "数据结构与算法课程涵盖常见数据结构如数组、链表、树、图，以及排序、搜索等经典算法。",
            "metadata": {
                "course": "数据结构与算法",
                "level": "中级",
                "duration": "50小时",
                "id": "ds_algo_001"
            },
            "source": "课程知识库"
        }
    ]
}
```

### 4. 多来源查询

当查询匹配多个知识点时，会返回多个参考来源：

**请求：**
```bash
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{
    "query": "有哪些适合初学者的课程？",
    "user_id": "user004"
  }'
```

**响应示例：**
```json
{
    "route": "course",
    "answer": "我们有多门适合初学者的课程，包括Python基础课程（40小时）和Web全栈开发课程（80小时）。Python基础课程适合零基础学员，涵盖基础语法和面向对象编程。",
    "sources": [
        {
            "index": 1,
            "content": "Python基础课程适合零基础学员，课程时长为40小时，包含基础语法、数据类型、函数、面向对象等内容。",
            "metadata": {
                "course": "Python基础",
                "level": "初级",
                "duration": "40小时",
                "id": "py_basic_001"
            },
            "source": "课程知识库"
        },
        {
            "index": 2,
            "content": "Web全栈开发课程包含前端React框架和后端Node.js，学习构建完整的Web应用。",
            "metadata": {
                "course": "Web全栈开发",
                "level": "中级",
                "duration": "80小时",
                "id": "web_fullstack_001"
            },
            "source": "课程知识库"
        }
    ]
}
```

## 前端展示建议

在前端界面中，可以这样展示参考来源：

```typescript
// 展示回答
<div className="answer">{response.answer}</div>

// 展示参考来源
<div className="sources">
  <h4>参考来源：</h4>
  {response.sources.map((source, idx) => (
    <div key={idx} className="source-item">
      <div className="source-header">
        <span className="source-index">来源 {source.index}</span>
        {source.metadata?.course && (
          <span className="course-tag">{source.metadata.course}</span>
        )}
        {source.metadata?.level && (
          <span className="level-tag">{source.metadata.level}</span>
        )}
      </div>
      <div className="source-content">{source.content}</div>
      {source.metadata?.duration && (
        <div className="source-meta">课程时长：{source.metadata.duration}</div>
      )}
    </div>
  ))}
</div>
```

## 注意事项

1. **content 字段**：为避免返回过长，自动截取前200字符
2. **metadata 字段**：包含导入时设置的所有元数据
3. **source 字段**：简化的来源标识，便于快速查看
4. **index 字段**：来源序号，按相关度排序（1最相关）

## 测试命令

```bash
# 测试健康检查
curl http://localhost:8000/health

# 测试欢迎语
curl http://localhost:8000/greet

# 测试课程查询
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"query":"Python课程适合什么人？","user_id":"test"}'

# 格式化输出（需要安装 jq）
curl -s -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"query":"Python课程适合什么人？","user_id":"test"}' | jq .
```
